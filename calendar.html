<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mood Calendar - MoodRay</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header gradient-header">
    <a href="index.html">
      <img src="images/logo 1.jpeg" alt="MoodRay Logo" class="logo" />
    </a>
  </header>

  <section class="section" id="mood-calendar">
    <div class="container">
      <h2>Track Your Mood</h2>
      <p>Select a date below to log your top 3 emotions!</p>
      <div id="calendar"></div>

      <!-- Mood picker modal -->
      <div id="moodPickerModal" class="modal hidden">
        <div class="modal-content">
          <h3>Select up to 3 moods</h3>
          <div id="moodOptions" class="mood-options"></div>
          <button id="saveMoodsBtn" class="cta-button">Save</button>
          <button id="cancelMoodsBtn" class="cta-button alt">Cancel</button>
        </div>
      </div>
      <div id="modalOverlay" class="modal-overlay hidden"></div>
    </div>
  </section>

  <footer class="footer">
    <p>&copy; 2025 MoodRay. All rights reserved.</p>
  </footer>

  <script>
    const moods = [
      { name: "Stressed", color: "black" },
      { name: "Nervous", color: "grey" },
      { name: "Tired", color: "brown" },
      { name: "Uncertain", color: "amber" },
      { name: "Calm", color: "green" },
      { name: "Relaxed", color: "bluegreen" },
      { name: "Happy", color: "blue" },
      { name: "Excited", color: "violet" },
      { name: "Loved", color: "pink" },
      { name: "Confident", color: "gold" }
    ];

    const maxMoodsPerDay = 3;

    const calendar = document.getElementById("calendar");
    const moodPickerModal = document.getElementById("moodPickerModal");
    const moodOptionsContainer = document.getElementById("moodOptions");
    const saveMoodsBtn = document.getElementById("saveMoodsBtn");
    const cancelMoodsBtn = document.getElementById("cancelMoodsBtn");
    const modalOverlay = document.getElementById("modalOverlay");

    let selectedDateKey = null;
    let selectedMoods = [];

    const getStoredMoods = (dateKey) => {
      const stored = localStorage.getItem(`mood-${dateKey}`);
      return stored ? JSON.parse(stored) : [];
    };

    const setStoredMoods = (dateKey, moodList) => {
      localStorage.setItem(`mood-${dateKey}`, JSON.stringify(moodList));
    };

    function renderCalendar() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let html = "<table><thead><tr>";
      const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      weekdays.forEach(day => (html += `<th>${day}</th>`));
      html += "</tr></thead><tbody><tr>";

      let dayCount = 1;
      for (let i = 0; i < 42; i++) {
        if (i < firstDay || dayCount > daysInMonth) {
          html += "<td></td>";
        } else {
          const dateKey = `${year}-${month + 1}-${dayCount}`;
          const moodsForDay = getStoredMoods(dateKey);
          const isToday = dayCount === now.getDate();

          html += `<td data-date="${dateKey}" class="${isToday ? "today" : ""}">`;
          html += `<div class="day-number">${dayCount}</div>`;
          moodsForDay.forEach(color => {
            html += `<span class="mood-circle mood-${color}"></span>`;
          });
          html += "</td>";
          dayCount++;
        }
        if ((i + 1) % 7 === 0) html += "</tr><tr>";
      }

      html += "</tr></tbody></table>";
      calendar.innerHTML = html;
    }

    function openMoodPicker(dateKey) {
      selectedDateKey = dateKey;
      selectedMoods = getStoredMoods(dateKey);
      moodOptionsContainer.innerHTML = "";

      moods.forEach(m => {
        const moodDiv = document.createElement("div");
        moodDiv.classList.add("mood-option");
        if (selectedMoods.includes(m.color)) moodDiv.classList.add("selected");
        moodDiv.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue(`--${m.color}`) || "";

        moodDiv.innerHTML = `
          <span class="mood-circle mood-${m.color}"></span>
          <span>${m.name}</span>
        `;

        moodDiv.addEventListener("click", () => {
          if (selectedMoods.includes(m.color)) {
            selectedMoods = selectedMoods.filter(c => c !== m.color);
            moodDiv.classList.remove("selected");
          } else {
            if (selectedMoods.length < maxMoodsPerDay) {
              selectedMoods.push(m.color);
              moodDiv.classList.add("selected");
            } else {
              alert(`You can only select up to ${maxMoodsPerDay} moods.`);
            }
          }
        });

        moodOptionsContainer.appendChild(moodDiv);
      });

      moodPickerModal.classList.remove("hidden");
      modalOverlay.classList.remove("hidden");
    }

    function closeMoodPicker() {
      moodPickerModal.classList.add("hidden");
      modalOverlay.classList.add("hidden");
      selectedDateKey = null;
      selectedMoods = [];
    }

    saveMoodsBtn.addEventListener("click", () => {
      if (selectedDateKey) {
        setStoredMoods(selectedDateKey, selectedMoods);
        renderCalendar();
        closeMoodPicker();
      }
    });

    cancelMoodsBtn.addEventListener("click", closeMoodPicker);
    modalOverlay.addEventListener("click", closeMoodPicker);

    calendar.addEventListener("click", e => {
      const td = e.target.closest("td[data-date]");
      if (td) {
        openMoodPicker(td.dataset.date);
      }
    });

    renderCalendar();
  </script>
</body>
</html>
